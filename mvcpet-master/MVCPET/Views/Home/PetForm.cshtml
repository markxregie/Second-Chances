@model dynamic

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    body {
        background-color: #f5f2da;
        font-family: Arial, sans-serif;
    }

    .form-container {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        width: 90%;
        max-width: 1000px;
        height: 90%;
        max-height: 800px;
        margin: 50px auto;
        margin-bottom: -5px;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .form-title {
        color: #00291C;
        font-weight: bold;
        text-align: center;
        margin-bottom: 40px;
    }

    .form-description {
        text-align: left;
        margin-bottom: 20px;
        color: #00291C;
    }

    .form-subtitle {
        font-weight: bold;
        color: #00291C;
    }

    .btn-next {
        background-color: #00291C;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
    }

        .btn-next:hover {
            background-color: #145a2d;
        }

    .btn-back {
        background-color: #00291C;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
    }

        .btn-back:hover {
            background-color: #145a2d;
        }

    .btn-submit {
        background-color: #00291C;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
    }

    .form-section {
        display: none;
        flex-grow: 1;
    }

        .form-section.active {
            display: block;
        }

    .button-container {
        position: sticky;
        bottom: 0;
        width: 100%;
        z-index: 1;
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
    }

    .custom-border {
        border-color: #687451 !important;
    }
</style>

<div class="form-container">
    <h2 class="form-title">Adoption Application</h2>

    <!-- Section 1 -->
    <div class="form-section active" id="section1">
        <h5 class="form-subtitle">PERSONAL INFORMATION</h5>
        <p class="form-description">
            Please provide your personal details so we can better understand your background
            and reach out to you regarding the adoption process.
        </p>
        <form id="form1">
            <div class="row mb-3">
                <div class="col-12">
                    <input type="text" class="form-control" id="name" placeholder="Name" value="@Model.UserName" readonly>
                </div>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="address" placeholder="Address" value="@Model.UserAddress" readonly>
                <label for="address">Address <span class="required"></span></label>
            </div>
            <div class="row mb-3">
                <div class="col-6">
                    <div class="form-floating">
                        <input type="number" class="form-control" id="phone" placeholder="Phone" required>
                        <label for="phone">Phone <span class="required"></span></label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating">
                        <input type="email" class="form-control" id="email" placeholder="Email" value="@Model.UserEmail" readonly>
                        <label for="email">Email <span class="required"></span></label>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-6">
                    <div class="form-floating">
                        <input type="date" class="form-control" id="birthDate" placeholder="Birth Date" required>
                        <label for="birthDate">Birth Date <span class="required"></span></label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="occupation" placeholder="Occupation" required>
                        <label for="occupation">Occupation <span class="required"></span></label>
                    </div>
                </div>
            </div>
            <div class="button-container">
                <button type="button" class="btn-back" onclick="window.history.back()">Cancel</button>
                <button type="button" class="btn-next" onclick="nextSection(1, 'next')">→</button>
            </div>
        </form>
    </div>

    <!-- Section 2 -->
    <div class="form-section" id="section2">
        <h5 class="form-subtitle">PERSONAL INFORMATION</h5>
        <p class="form-description">
            Please provide your personal details so we can better understand your background
            and reach out to you regarding the adoption process.
        </p>
        <form id="form2">
            <!-- First row: Marital Status and Pronouns -->
            <div class="row mb-3">
                <div class="col-6">
                    <label>Marital Status <span class="required"></span></label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="maritalStatus" id="single" value="single" required>
                        <label class="form-check-label" for="single">Single</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="maritalStatus" id="married" value="married" required>
                        <label class="form-check-label" for="married">Married</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="maritalStatus" id="other" value="other" required>
                        <label class="form-check-label" for="other">Other</label>
                    </div>
                </div>
                <div class="col-6">
                    <label>Pronouns <span class="required"></span></label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="pronouns" id="she" value="she" required>
                        <label class="form-check-label" for="she">She/Her</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="pronouns" id="he" value="he" required>
                        <label class="form-check-label" for="he">He/Him</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="pronouns" id="they" value="they" required>
                        <label class="form-check-label" for="they">They/Them</label>
                    </div>
                </div>
            </div>

            <!-- Second row: Yes/No question -->
            <div class="row mb-3">
                <div class="col-6">
                    <label style="margin-top: 10px;">Have you adopted from Second Chances before? <span class="required"></span></label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="agree" id="yes" value="yes" required>
                        <label class="form-check-label" for="yes">Yes</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="agree" id="no" value="no" required>
                        <label class="form-check-label" for="no">No</label>
                    </div>
                </div>
            </div>

            <!-- Third row: Another Yes/No question -->
            <div class="form-row mb-3">
                <div class="col">
                    <label style="margin-top: 10px;">Are you adopting this pet for another person? <span class="required"></span></label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="reviewed" id="termsYes" value="yes" required>
                        <label class="form-check-label" for="termsYes">Yes</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="reviewed" id="termsNo" value="no" required>
                        <label class="form-check-label" for="termsNo">No</label>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button type="button" class="btn-back" onclick="nextSection(2, 'back')">←</button>
                <button type="button" class="btn-next" onclick="nextSection(2, 'next')">→</button>
            </div>
        </form>
    </div>

    <!-- Section 3 -->
    <div class="form-section" id="section3">
        <h5 class="form-subtitle">PET REFERENCE</h5>
        <p class="form-description">
            Kindly share your preferences for the type of pet you wish to adopt.
        </p>
        <form id="form3">
            <div class="col">
                <label>What are you looking to adopt? <span class="required"></span></label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="petToAdopt" id="cat" value="cat" required>
                    <label class="form-check-label" for="cat">Cat</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="petToAdopt" id="dog" value="dog" required>
                    <label class="form-check-label" for="dog">Dog</label>
                </div>
            </div>
            <div class="button-container">
                <button type="button" class="btn-back" onclick="nextSection(3, 'back')">←</button>
                <button type="button" class="btn-next" onclick="nextSection(3, 'next')">→</button>
            </div>
        </form>
    </div>

    <!-- Section 4 -->
    <div class="form-section" id="section4">
        <h5 class="form-subtitle">LIVING STATUS</h5>
        <p class="form-description">
            We would appreciate details about your living environment to ensure the selected pet will be comfortable and safe in your home.
        </p>
        <form id="form4">
            <!-- Row for building type and renting status -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label>What type of building do you live in? <span class="required"></span></label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="buildingType" id="house" value="house" required>
                        <label class="form-check-label" for="house">House</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="buildingType" id="condo" value="condo" required>
                        <label class="form-check-label" for="condo">Condo</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="buildingType" id="apartment" value="apartment" required>
                        <label class="form-check-label" for="apartment">Apartment</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="buildingType" id="otherBuilding" value="other" required>
                        <label class="form-check-label" for="otherBuilding">Other</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <label>Do you rent? <span class="required"></span></label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="rentStatus" id="rentYes" value="yes" required>
                        <label class="form-check-label" for="rentYes">Yes</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="rentStatus" id="rentNo" value="no" required>
                        <label class="form-check-label" for="rentNo">No</label>
                    </div>
                </div>
            </div>

            <!-- Row for living companions -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label>Who do you live with? <span class="required"></span></label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="household" id="livingAlone" value="Living Alone">
                        <label class="form-check-label" for="livingAlone">Living Alone</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="household" id="childrenOver18" value="Children over 18">
                        <label class="form-check-label" for="childrenOver18">Children over 18</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="household" id="childrenUnder18" value="Children below 18">
                        <label class="form-check-label" for="childrenUnder18">Children below 18</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="household" id="spouse" value="Spouse">
                        <label class="form-check-label" for="spouse">Spouse</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-check mt-4">
                        <input class="form-check-input" type="checkbox" name="household" id="parents" value="Parents">
                        <label class="form-check-label" for="parents">Parents</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="household" id="roommates" value="Roommate(s)">
                        <label class="form-check-label" for="roommates">Roommate(s)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="household" id="relatives" value="Relatives">
                        <label class="form-check-label" for="relatives">Relatives</label>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button type="button" class="btn-back" onclick="nextSection(4, 'back')">←</button>
                <button type="button" class="btn-next" onclick="nextSection(4, 'next')">→</button>
            </div>
        </form>
    </div>

    <!-- Section 5: Submission -->
    <div class="form-section" id="section5">
        <h5 class="form-subtitle">INTERVIEW AND VISITATION</h5>
        <p class="form-description">
            By submitting this form, you acknowledge and agree to the following terms and conditions:
        </p>
        <div style="background-color: #f8d7da; border-left: 6px solid #dc3545; padding: 15px; font-size: 16px;">
            <ul style="list-style-type: none; padding-left: 0;">
                <li><strong style="color: #dc3545;">Your adoption request is pending approval upon submission.</strong></li>
                <li><strong style="color: #dc3545;">The status of your request will be updated in your User Profile as well in your provided Email Address.</strong></li>
                <li><strong style="color: #dc3545;">You are required to attend an onsite interview once your request has been approved.</strong></li>
                <li><strong style="color: #dc3545;">If you do not attend the interview within 3 days, your adoption request will be denied.</strong></li>
            </ul>
        </div>
        <form id="adoptionForm">
            <input type="hidden" id="userId" value="@Model.UserId">
            <input type="hidden" id="userName" value="@Model.UserName">
            <input type="hidden" id="userAddress" value="@Model.UserAddress">
            <input type="hidden" id="userEmail" value="@Model.UserEmail">
            <input type="hidden" id="petId" value="@Model.Pet.Id">
            <div class="button-container">
                <button type="button" class="btn-back" onclick="nextSection(5, 'back')">←</button>
                <button type="submit" class="btn-submit">Submit</button>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let petId = new URLSearchParams(window.location.search).get("petId");
        if(document.getElementById("petId")){
            document.getElementById("petId").value = petId;
        }
    });

    function nextSection(sectionNumber, direction) {
        if (direction === 'next') {
            if (!validateSection(sectionNumber)) {
                alert("Please fill out all required fields before proceeding.");
                return;
            }
        }

        // Hide the current section
        const currentSection = document.getElementById('section' + sectionNumber);
        currentSection.classList.remove('active');

        // Calculate the target section number
        const targetSectionNumber = direction === 'next' ? sectionNumber + 1 : sectionNumber - 1;

        // Show the target section if it exists
        const targetSection = document.getElementById('section' + targetSectionNumber);
        if (targetSection) {
            targetSection.classList.add('active');
        } else {
            console.error(`Section ${targetSectionNumber} does not exist.`);
        }
    }

    function validateSection(sectionNumber) {
        const section = document.getElementById('section' + sectionNumber);
        const inputs = section.querySelectorAll("input[required], select[required], textarea[required]");
        let valid = true;

        inputs.forEach(input => {
            if (input.type === "radio") {
                const name = input.name;
                if (!document.querySelector(`input[name="${name}"]:checked`)) {
                    valid = false;
                }
            } else if (input.type === "checkbox") {
                const groupName = input.name;
                if (document.querySelectorAll(`input[name="${groupName}"]:checked`).length === 0) {
                    valid = false;
                }
            } else {
                if (!input.value.trim()) {
                    valid = false;
                }
            }
        });

        return valid;
    }

    document.getElementById("adoptionForm").addEventListener("submit", function(event) {
        event.preventDefault();

        let formData = {
            PetId: parseInt(document.getElementById("petId").value),
            UserId: parseInt(document.getElementById("userId").value),
            Name: document.getElementById("userName").value.trim(),
            Address: document.getElementById("userAddress").value.trim(),
            Email: document.getElementById("userEmail").value.trim(),
            Phone: document.getElementById("phone").value.trim(),
            BirthDate: formatDate(document.getElementById("birthDate").value),
            Occupation: document.getElementById("occupation").value.trim(),
            MaritalStatus: document.querySelector("input[name='maritalStatus']:checked")?.value || "Single",
            Pronouns: document.querySelector("input[name='pronouns']:checked")?.value || "Not specified",
            HasAdoptedBefore: document.querySelector("input[name='agree']:checked")?.value === "yes",
            IsAdoptingForAnother: document.querySelector("input[name='reviewed']:checked")?.value === "yes",
            PetPreference: document.querySelector("input[name='petToAdopt']:checked")?.value || "Not specified",
            LivingType: document.querySelector("input[name='buildingType']:checked")?.value || "Not specified",
            IsRenting: document.querySelector("input[name='rentStatus']:checked")?.value === "yes",
            HouseholdMembers: getHouseholdMembers(),
            AgreesToInterview: true
        };

        console.log("Sending Adoption Request:", formData);

        fetch('/Adoption/SubmitAdoption', {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            console.log("Server Response:", data);
            if (data.success) {
                alert("Adoption request submitted successfully!");
                window.location.href = "/";
            } else {
                alert("Submission failed: " + (data.errors ? data.errors.join(', ') : data.message));
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("An error occurred while submitting the form.");
        });
    });

    function formatDate(dateString) {
        if (!dateString) return null;
        let date = new Date(dateString);
        return date.toISOString();
    }

    function getHouseholdMembers() {
        let members = [];
        document.querySelectorAll("input[name='household']:checked").forEach((checkbox) => {
            members.push(checkbox.value);
        });
        return members.join(", ");
    }
</script>